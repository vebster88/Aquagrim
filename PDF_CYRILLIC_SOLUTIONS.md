# Варианты решения проблемы с кириллицей в PDF

## Проблема
PDFKit не отображает кириллицу корректно, даже с загруженным шрифтом.

## Варианты решения

### Вариант 1: HTML-to-PDF через Puppeteer (РЕКОМЕНДУЕТСЯ)
**Плюсы:**
- ✅ Отличная поддержка кириллицы из коробки
- ✅ Полный контроль над стилями через CSS
- ✅ Работает с любыми шрифтами через CSS
- ✅ Проще в разработке (HTML вместо низкоуровневого API)

**Минусы:**
- ⚠️ Требует больше ресурсов (headless браузер)
- ⚠️ Больший размер bundle
- ⚠️ Может быть медленнее для простых документов

**Реализация:**
```typescript
import puppeteer from 'puppeteer-core';
import chromium from '@sparticuz/chromium'; // для Vercel

// Генерируем HTML с кириллицей
const html = generateHTML(report, site);
// Конвертируем в PDF
const pdf = await generatePDFFromHTML(html);
```

---

### Вариант 2: PDFMake (легковесная альтернатива)
**Плюсы:**
- ✅ Хорошая поддержка кириллицы
- ✅ Легковесная библиотека
- ✅ Простой API
- ✅ Работает в serverless

**Минусы:**
- ⚠️ Меньше контроля над макетом
- ⚠️ Нужно добавить шрифт в проект

**Реализация:**
```typescript
import PdfPrinter from 'pdfmake';
// Использует встроенные шрифты с поддержкой кириллицы
```

---

### Вариант 3: Встроить шрифт в код (Base64)
**Плюсы:**
- ✅ Не требует внешних запросов
- ✅ Работает офлайн
- ✅ Надежно для serverless

**Минусы:**
- ⚠️ Увеличивает размер кода
- ⚠️ Нужно найти и встроить шрифт

**Реализация:**
```typescript
// Шрифт как base64 строка
const fontBase64 = 'AAEAAAAOAIAAAwBgT1MvMj...';
const fontBuffer = Buffer.from(fontBase64, 'base64');
```

---

### Вариант 4: Использовать готовый сервис
**Плюсы:**
- ✅ Не нужно поддерживать код
- ✅ Гарантированная поддержка кириллицы

**Минусы:**
- ⚠️ Зависимость от внешнего сервиса
- ⚠️ Может быть платным
- ⚠️ Дополнительная задержка

**Примеры:**
- HTML/CSS to PDF API
- PDFShift
- Gotenberg

---

### Вариант 5: Исправить текущую реализацию PDFKit
**Проблемы в текущем коде:**
1. Шрифт может не применяться ко всем текстам
2. Нужно явно устанавливать шрифт перед каждым текстом
3. Возможно, проблема с кодировкой при сохранении файла

**Что проверить:**
- Логи загрузки шрифта
- Правильность регистрации шрифта
- Применение шрифта ко всем текстам

---

## Рекомендация

**Для Vercel serverless лучше всего подходит Вариант 1 (Puppeteer) или Вариант 2 (PDFMake).**

### Почему Puppeteer:
- Отличная поддержка кириллицы
- Гибкость в дизайне
- Работает на Vercel (через @sparticuz/chromium)

### Почему PDFMake:
- Легковесная
- Простая в использовании
- Хорошая поддержка кириллицы

---

## Следующие шаги

1. Выберите вариант
2. Я помогу реализовать выбранное решение
3. Протестируем на реальных данных



